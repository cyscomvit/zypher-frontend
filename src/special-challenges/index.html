<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Special Challenges</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

</head>



<body data-bs-theme="dark">
    <div class="container">
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Zypher | Special Challenges</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="/">Home</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

    </div>
    <div class="container-fluid">
        <div class="container mt-2 mb-3 border-top pt-3">
            <div class="card" style="width: 18rem;">
                <div class="card-body">
                    <h5 class="card-title" id="challenge_1_title">Challenge Title</h5>
                    <h6 class="card-subtitle mb-2 text-body-secondary">Challenge 1</h6>
                    <p class="card-text" id="challenge_1_desc">Some quick example text to build on the card title and
                        make up the bulk of the
                        card's content.</p>
                    <a href="#" class="card-link" id="challenge_1_link">Challenge link</a>


                </div>
                <div class="container">
                    <div class="completed_challenge_1"></div>

                    <form id="flag_1_form">
                        <div class="mb-3">
                            <label for="flag1" class="form-label">Enter the flag here: </label>
                            <input type="text" class="form-control" id="flag1" aria-describedby="flag1">
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>
        </div>


    </div>

    <div class="container-fluid">
        <div class="container mt-2 mb-3 border-top pt-3">
            <div class="card" style="width: 18rem;">
                <div class="card-body">
                    <h5 class="card-title" id="challenge_2_title">Challenge Title</h5>
                    <h6 class="card-subtitle mb-2 text-body-secondary">Challenge 2</h6>
                    <p class="card-text" id="challenge_2_desc">Some quick example text to build on the card title and
                        make up the bulk of the
                        card's content.</p>
                    <a href="#" class="card-link" id="challenge_2_link">Challenge link</a>


                </div>
                <div class="container">

                    <div class="completed_challenge_2"></div>

                    <form id="flag_2_form">
                        <div class="mb-3">
                            <label for="flag2" class="form-label">Enter the flag here: </label>
                            <input type="text" class="form-control" id="flag2" aria-describedby="flag2">
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <div class="container-fluid">
        <div class="container mt-2 mb-3 border-top pt-3">
            <div class="card" style="width: 18rem;">
                <div class="card-body">
                    <h5 class="card-title" id="challenge_3_title">Challenge Title</h5>
                    <h6 class="card-subtitle mb-2 text-body-secondary">Challenge 3</h6>
                    <p class="card-text" id="challenge_3_desc">Some quick example text to build on the card title and
                        make up the bulk of the
                        card's content.</p>
                    <a href="#" class="card-link" id="challenge_3_link">Challenge link</a>


                </div>
                <div class="container">
                    <div class="completed_challenge_3"></div>

                    <form id="flag_3_form">
                        <div class="mb-3">
                            <label for="flag3" class="form-label">Enter the flag here: </label>
                            <input type="text" class="form-control" id="flag3" aria-describedby="flag3">
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <div class="container-fluid">
        <div class="card" style="width: 18rem;">
            <div class="card-body">
                <h5 class="card-title" id="challenge_4_title">Challenge Title</h5>
                <h6 class="card-subtitle mb-2 text-body-secondary">Challenge 4</h6>
                <p class="card-text" id="challenge_4_desc">Some quick example text to build on the card title and make
                    up the bulk of the
                    card's content.</p>
                <a href="#" class="card-link" id="challenge_4_link">Challenge link</a>


            </div>
            <div class="container">
                <div class="completed_challenge_4"></div>

                <form id="flag_4_form">
                    <div class="mb-3">
                        <label for="flag4" class="form-label">Enter the flag here: </label>
                        <input type="text" class="form-control" id="flag4" aria-describedby="flag4">
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>

    </div>

    <div class="container-fluid">
        <div class="card" style="width: 18rem;">
            <div class="card-body">
                <h5 class="card-title" id="challenge_5_title">Challenge Title</h5>
                <h6 class="card-subtitle mb-2 text-body-secondary">Challenge 5</h6>
                <p class="card-text" id="challenge_5_desc">Some quick example text to build on the card title and make
                    up the bulk of the
                    card's content.</p>
                <a href="#" class="card-link" id="challenge_5_link">Challenge link</a>


            </div>
            <div class="container">
                <div class="completed_challenge_5"></div>

                <form id="flag_5_form">
                    <div class="mb-3">
                        <label for="flag5" class="form-label">Enter the flag here: </label>
                        <input type="text" class="form-control" id="flag5" aria-describedby="flag5">
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>

    </div>

</body>
<script type="module">
    import { BACKEND } from "../api.js";

    if (localStorage.getItem("jwt") == null) {
        window.location.href = "../login";
    }

    let userData = fetch(`${BACKEND}/me`, {
        method: "GET",
        headers: {
            "Authorization": `Bearer ${localStorage.getItem("jwt")}`
        }
    }).then(res => res.json()).then(data => {
        let completed_challenges = data.answered_special_challenges;
        // its an array in string
        completed_challenges = completed_challenges.split(",");
        console.log(completed_challenges);
        // checking if the user has completed the challenge or not, if yes, then remove input and submit button and show "challenge completed"
        if (completed_challenges.includes("1")) {
            document.getElementById("flag_1_form").remove();
            document.querySelector(".completed_challenge_1").innerHTML = "Challenge Completed";
        }
        if (completed_challenges.includes("2")) {
            document.getElementById("challenge_2_submit").remove();
            document.querySelector(".completed_challenge_2").innerHTML = "Challenge Completed";
        }
        if (completed_challenges.includes("3")) {
            document.getElementById("challenge_3_submit").remove();
            document.querySelector(".completed_challenge_3").innerHTML = "Challenge Completed";
        }
        if (completed_challenges.includes("4")) {
            document.getElementById("challenge_4_submit").remove();
            document.querySelector(".completed_challenge_4").innerHTML = "Challenge Completed";
        }
        if (completed_challenges.includes("5")) {
            document.getElementById("challenge_5_submit").remove();
            document.querySelector(".completed_challenge_5").innerHTML = "Challenge Completed";
        }

    })

    // fetch the special challenges
    fetch(`${BACKEND}/special-question`, {
        method: "GET",
        headers: {
            "Authorization": `Bearer ${localStorage.getItem("jwt")}`
        }
    }).then(res => res.json()).then(data => {
        console.log(data)
        //    update the special challenges content at their respective ids
        document.getElementById("challenge_1_title").innerHTML = data[0].text;
        document.getElementById("challenge_1_desc").innerHTML = data[0].description;
        document.getElementById("challenge_1_link").href = data[0].link;
        
        document.getElementById("challenge_2_title").innerHTML = data[1].text;
        document.getElementById("challenge_2_desc").innerHTML = data[1].description;
        document.getElementById("challenge_2_link").href = data[1].link;

        document.getElementById("challenge_3_title").innerHTML = data[2].text;
        document.getElementById("challenge_3_desc").innerHTML = data[2].description;
        document.getElementById("challenge_3_link").href = data[2].link;

        document.getElementById("challenge_4_title").innerHTML = data[3].text;
        document.getElementById("challenge_4_desc").innerHTML = data[3].description;
        document.getElementById("challenge_4_link").href = data[3].link;

        document.getElementById("challenge_5_title").innerHTML = data[4].text;
        document.getElementById("challenge_5_desc").innerHTML = data[4].description;
        document.getElementById("challenge_5_link").href = data[4].link;



    })

    // submit the flag
    document.getElementById("flag_1_form").addEventListener("submit", (e) => {
        e.preventDefault();
        let flag = document.getElementById("flag1").value;
        console.log(flag);
        fetch(`${BACKEND}/special-answer/`, {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("jwt")}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                question_level:1,
                "answer": flag
            })
        }).then(res => res.json()).then(data => {
            console.log(data);
            if (data.correct == true) {
                document.getElementById("flag_1_form").remove();
                document.querySelector(".completed_challenge_1").innerHTML = "Challenge Completed";
            }
            else{
                alert("Wrong Answer");
            }
        })
    })

    document.getElementById("flag_2_form").addEventListener("submit", (e) => {
        e.preventDefault();
        let flag = document.getElementById("flag2").value;
        console.log(flag);
        fetch(`${BACKEND}/special-answer/`, {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("jwt")}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                question_level:2,
                "answer": flag
            })
        }).then(res => res.json()).then(data => {
            console.log(data);
            if (data.correct == true) {
                document.getElementById("flag_2_form").remove();
                document.querySelector(".completed_challenge_2").innerHTML = "Challenge Completed";
            }
            else{
                alert("Wrong Answer");
            }
        })
    })

    document.getElementById("flag_3_form").addEventListener("submit", (e) => {
        e.preventDefault();
        let flag = document.getElementById("flag3").value;
        console.log(flag);
        fetch(`${BACKEND}/special-answer/`, {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("jwt")}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                question_level:3,
                "answer": flag
            })
        }).then(res => res.json()).then(data => {
            console.log(data);
            if (data.correct == true) {
                document.getElementById("flag_3_form").remove();
                document.querySelector(".completed_challenge_3").innerHTML = "Challenge Completed";
            }
            else{
                alert("Wrong Answer");
            }
        })
    })

    document.getElementById("flag_4_form").addEventListener("submit", (e) => {
        e.preventDefault();
        let flag = document.getElementById("flag4").value;
        console.log(flag);
        fetch(`${BACKEND}/special-answer/`, {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("jwt")}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                question_level:4,
                "answer": flag
            })
        }).then(res => res.json()).then(data => {
            console.log(data);
            if (data.correct == true) {
                document.getElementById("flag_4_form").remove();
                document.querySelector(".completed_challenge_4").innerHTML = "Challenge Completed";
            }
            else{
                alert("Wrong Answer");
            }
        })
    })

    document.getElementById("flag_5_form").addEventListener("submit", (e) => {
        e.preventDefault();
        let flag = document.getElementById("flag5").value;
        console.log(flag);
        fetch(`${BACKEND}/special-answer/`, {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("jwt")}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                question_level:5,
                "answer": flag
            })
        }).then(res => res.json()).then(data => {
            console.log(data);
            if (data.correct == true) {
                document.getElementById("flag_5_form").remove();
                document.querySelector(".completed_challenge_5").innerHTML = "Challenge Completed";
            }
            else{
                alert("Wrong Answer");
            }
        })
    })





</script>

</html>